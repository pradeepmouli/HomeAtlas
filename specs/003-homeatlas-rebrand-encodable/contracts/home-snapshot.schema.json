{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://homeatlas.dev/schemas/home-snapshot.schema.json",
  "title": "HomeAtlas Home Snapshot",
  "type": "object",
  "required": ["homes"],
  "properties": {
    "homes": {
      "type": "array",
      "items": { "$ref": "#/$defs/home" }
    }
  },
  "$defs": {
    "home": {
      "type": "object",
      "required": ["id", "name", "rooms", "zones"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string" },
        "rooms": { "type": "array", "items": { "$ref": "#/$defs/room" } },
        "zones": { "type": "array", "items": { "$ref": "#/$defs/zone" } },
        "metadata": { "type": "object", "additionalProperties": true }
      },
      "additionalProperties": false
    },
    "zone": {
      "type": "object",
      "required": ["id", "name", "roomIds"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string" },
        "roomIds": { "type": "array", "items": { "type": "string", "minLength": 1 } }
      },
      "additionalProperties": false
    },
    "room": {
      "type": "object",
      "required": ["id", "name", "accessories"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string" },
        "accessories": { "type": "array", "items": { "$ref": "#/$defs/accessory" } }
      },
      "additionalProperties": false
    },
    "accessory": {
      "type": "object",
      "required": ["id", "name", "services"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string" },
        "manufacturer": { "type": "string" },
        "model": { "type": "string" },
        "firmwareVersion": { "type": "string" },
        "services": { "type": "array", "items": { "$ref": "#/$defs/service" } }
      },
      "additionalProperties": false
    },
    "service": {
      "type": "object",
      "required": ["id", "serviceType", "characteristics"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string" },
        "serviceType": { "type": "string", "minLength": 1 },
        "characteristics": { "type": "array", "items": { "$ref": "#/$defs/characteristic" } }
      },
      "additionalProperties": false
    },
    "characteristic": {
      "type": "object",
      "required": ["id", "characteristicType", "readable", "writable"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "characteristicType": { "type": "string", "minLength": 1 },
        "displayName": { "type": "string" },
        "unit": { "type": "string" },
        "min": { "type": "number" },
        "max": { "type": "number" },
        "step": { "type": "number" },
        "readable": { "type": "boolean" },
        "writable": { "type": "boolean" },
        "value": {},
        "reason": { "type": "string", "enum": ["permission", "unavailable", "unknown"] }
      },
      "allOf": [
        {
          "if": { "properties": { "value": { "type": "null" } }, "required": ["value"] },
          "then": { "required": ["reason"] }
        }
      ],
      "additionalProperties": false
    }
  }
}
